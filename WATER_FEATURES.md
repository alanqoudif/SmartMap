# المعالم المائية - دليل المطور

## نظرة عامة

تم إضافة ميزة المعالم المائية إلى خريطة عُنْوَنِي لعرض المسطحات المائية في منطقة مسقط، سلطنة عُمان. هذه الميزة تستخدم Google Maps API لعرض المعالم المائية كطبقات تفاعلية.

## المكونات المضافة

### 1. أنواع البيانات الجديدة (`src/types/index.ts`)

```typescript
export interface WaterFeature {
  id: string
  name: string
  type: 'sea' | 'lake' | 'river' | 'pond' | 'fountain'
  coordinates: [number, number][]
  lat?: number
  lng?: number
  area?: number
  description?: string
}
```

### 2. مكون WaterLayer (`src/components/WaterLayer/WaterLayer.tsx`)

مكون React مسؤول عن عرض المعالم المائية على خريطة Google:

- **البحر**: لون أزرق فاتح مع شفافية 60%
- **البحيرة**: لون أزرق متوسط مع شفافية 70%
- **النهر/الوادي**: خط أزرق بسماكة 4 بكسل
- **البركة**: لون أزرق فاتح مع شفافية 80%
- **النافورة**: لون سماوي مع شفافية 90%

### 3. بيانات المعالم المائية (`src/data/muscat-water.json`)

يحتوي على 7 معالم مائية في منطقة مسقط:

1. **بحر عمان - خليج مسقط**: المسطح المائي الرئيسي
2. **بحيرة القرم الطبيعية**: بحيرة طبيعية في منطقة القرم
3. **وادي عدي**: مجرى مائي طبيعي
4. **بركة السلطان قابوس**: بركة مائية في منطقة السلطان قابوس
5. **نافورة مسقط الكبرى**: نافورة مائية في وسط المنطقة
6. **خليج مطرح**: منطقة ساحلية
7. **بحيرة بوشر**: بحيرة طبيعية

## كيفية الاستخدام

### إظهار/إخفاء المعالم المائية

```typescript
// في App.tsx
const [showWater, setShowWater] = useState(true)

const handleToggleWater = useCallback(() => {
  setShowWater(prev => !prev)
}, [])
```

### تمرير البيانات إلى GoogleMap

```typescript
<GoogleMap
  houses={houses}
  onHouseSelect={handleHouseSelect}
  onMapClick={handleMapClick}
  selectedHouse={selectedHouse}
  waterFeatures={waterFeatures}
  showWater={showWater}
/>
```

## التخصيص

### إضافة معلم مائي جديد

1. أضف البيانات إلى `src/data/muscat-water.json`:

```json
{
  "id": "unique-id",
  "name": "اسم المعلم",
  "type": "sea|lake|river|pond|fountain",
  "coordinates": [
    [lat1, lng1],
    [lat2, lng2],
    // ... المزيد من الإحداثيات
  ],
  "lat": 23.6141,
  "lng": 58.5922,
  "area": 10000,
  "description": "وصف المعلم"
}
```

2. سيتم عرضه تلقائياً على الخريطة

### تخصيص الألوان

عدّل الألوان في `src/components/WaterLayer/WaterLayer.tsx`:

```typescript
// للبحر
fillColor: '#4A90E2',
fillOpacity: 0.6,
strokeColor: '#2E5BBA',

// للبحيرة
fillColor: '#5BA3F5',
fillOpacity: 0.7,
strokeColor: '#3A7BC8',
```

## التفاعل

### نافذة المعلومات

عند النقر على أي معلم مائي، تظهر نافذة معلومات تحتوي على:
- اسم المعلم
- نوع المعلم
- المساحة (إن وجدت)
- الوصف (إن وجد)

### التكامل مع شريط الأدوات

تم إضافة:
- زر "ماء" في أدوات الرسم
- زر "إظهار/إخفاء الماء" في قسم الإجراءات
- دعم في شريط الأدوات المحمول

## الأداء

- المعالم المائية تُحمل فقط عند الحاجة
- يتم مسح الطبقات السابقة عند التحديث
- لا تؤثر على أداء الخريطة الأساسية

## التطوير المستقبلي

- [ ] إضافة معالم مائية ديناميكية من OpenStreetMap
- [ ] دعم رسم المعالم المائية الجديدة
- [ ] إضافة معلومات إضافية (العمق، نوع المياه، إلخ)
- [ ] دعم طبقات مائية متعددة
- [ ] تصدير المعالم المائية كطبقة منفصلة

## استكشاف الأخطاء

### المعالم المائية لا تظهر

1. تأكد من أن `showWater` = `true`
2. تحقق من وجود بيانات في `waterFeatures`
3. تأكد من تحميل Google Maps API

### أخطاء في الإحداثيات

1. تأكد من صحة تنسيق الإحداثيات `[lat, lng]`
2. تحقق من أن الإحداثيات ضمن نطاق منطقة مسقط
3. تأكد من إغلاق المضلعات بشكل صحيح

---

تم تطوير هذه الميزة باستخدام Google Maps API و React TypeScript.
