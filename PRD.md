# PRD – مشروع "عُنْوَنِي"  
نسخة MVP – فرونت-إند فقط – عُمان – خريطة افتراضية تفاعلية

---

## 1. رؤية عالية المستوى
تمكين سكان سلطنة عُمان من تصميم وتصفح خرائط منازلهم وعنونة أحيائهم بشكل رقمي تفاعلي دون الحاجة إلى أي خدمة خلفية أو API خارجي، مع إمكانية الترقية لاحقًا إلى خرائط Google وخدمات AI.

---

## 2. أهداف النسخة MVP
1. عرض خريطة افتراضية قابلة للتكبير/التصغير والسحب (Pan & Zoom).
2. شبكة Grid قابلة للتبديل (10×10 متر افتراضي).
3. أدوات رسم سريعة: جدار، ممر، مدخل/خرج، كشك/خدمة، قطعة أرض (Plot).
4. لوحة إدخال: «Search Your Address» تبحث محليًا داخل ملف JSON ثابت يحتوي على أرقام بيوت وإحداثياتها الافتراضية (X,Y).
5. عند اختيار عنوان → تتحرك الكاميرا إلى القطعة ويظهر منبثق بسيط (Pop-over) يعرض: رقم القطعة، رقم البيت، زر «تصفح المنزل».
6. وضع «تصفح المنزل»: تُخفى أدوات الرسم وتظهر طبقة جديدة (React component) تعرض:
   - مخطط بسيط للمنزل (صورة SVG ثابتة أو رسم تفاعلي صغير).
   - معلومات نصية (المساحة، عدد الغرف، الاتجاه، ملاحظة حرة يدخلها المستخدم وتُحفظ في localStorage).
7. تصدير: زر «احفظ صورة الخريطة» (يصدر اللوحة الحالية إلى PNG عبر html2canvas).
8. لا توجد تسجيلات دخول أو قواعد بيانات – كل البيانات تُخزن مؤقتًا في localStorage.
9. الأداء: أول ظهور للخريطة <1.5 ثانية على 3G.
10. التقنيات: Bun + React 18 + TypeScript + Tailwind CSS + Vite (مدمج مع Bun).

---

## 3. المستخدمون الأساسيون
- المقيم في عُمان يريد عنونة منزله.
- مهندس/مصمم يرسم مخططًا أوليًا لحي سكني صغير.
- الزائر العادي يبحث عن عنوان صديقه ويتصفح تفاصيل المنزل.

---

## 4. سيناريوهات المستخدم الرئيسية
**UC-1** البحث عن عنوان  
1. يفتح الموقع.  
2. يكتب في شريط البحث «المنزل 45».  
3. تظهر قائمة منسدلة بكلمة «المنزل 45 – قطعة 102».  
4. يضغط Enter.  
5. تنتقل الكاميرا إلى الاحداثي (1020, 840).  
6. يظهر منبثق يحتوي على زر «تصفح المنزل».  

**UC-2** رسم حي جديد  
1. يضغط أيقونة «وضع الرسم».  
2. يختار أداة «قطعة أرض».  
3. ينقر نقطتين على الشبكة لرسم مستطيل.  
4. يختار «مدخل» ويضعه على أحد الجوانب.  
5. يضغط «حفظ» (يُحفظ في localStorage).  

**UC-3** تصفح المنزل  
1. بعد UC-1 يضغط «تصفح المنزل».  
2. تظهر طبقة جديدة (Modal) تحتوي:  
   a. صورة مخطط المنزل (SVG).  
   b. حقول نصية للمساحة والغرف والملاحظات.  
   c. زر «أغلق».  

---

## 5. نطاق المشروع (In/Out)
**Inside**  
- خريطة افتراضية SVG/Canvas.  
- بحث محلي (JSON ثابت).  
- تخزين localStorage.  
- تصدير PNG.  

**Outside**  
- لا Back-end.  
- لا Google Maps API.  
- لا تسجيل دخول.  
- لا توقع كتل سلسلة (Blockchain).  
- لا خدمات دفع.

---

## 6. البنية (Architecture)
**Frontend Only – Static Hosting (GitHub Pages / Cloudflare Pages)**

```
┌---------------------------┐
│ Bun + Vite (dev/build)    │
├---------------------------┤
│ React 18 + TypeScript     │
├---------------------------┤
│ Tailwind CSS              │
├---------------------------┤
│ Fabric.js (Canvas)        │
│  أو SVG <g> + d3-zoom      │
├---------------------------┤
│ localStorage              │
└---------------------------┘
```

**Folder Structure**
```
src/
 ├─ components/
 │   ├─ MapCanvas/
 │   ├─ ToolBar/
 │   ├─ SearchBox/
 │   ├─ HouseViewer/
 │   └─ ExportButton/
 ├─ data/
 │   └─ oman-houses.json   // {id, houseNo, plotNo, x, y}
 ├─ hooks/
 │   ├─ useLocalStorage.ts
 │   └─ useGridSnap.ts
 ├─ utils/
 │   ├─ exportPNG.ts
 │   └─ snapToGrid.ts
 └─ main.tsx
```

---

## 7. التصميم (UX)
- شاشة واحدة أفقية: الشريط الجانبي (240px) للأدوات، بقية المساحة للخريطة.
- الألوان: رمادي فاتح للشبكة، أخضر للممرات، أزرق للمداخل، برتقالي للأكشاك.
- Tailwind palette: slate / emerald / blue / orange.
- أيقونات: HeroIcons (CDN).
- Responsive: يختفي الشريط الجانبي ويتحول إلى شريط سفلي على الشاشات < 768px.

---

## 8. جدول البيانات (Data Schema)
**oman-houses.json**
```json
[
  {
    "id": "45-102",
    "houseNo": 45,
    "plotNo": 102,
    "x": 1020,
    "y": 840,
    "areaM2": 400,
    "rooms": 4
  }
]
```

**localStorage key: «userMap»**
```json
{
  "version": 1,
  "elements": [
    {"type":"wall", "points":[[0,0],[200,0]]},
    {"type":"plot", "id":"45-102", "rect":[x,y,w,h]}
  ],
  "houseNotes": {"45-102": "ملاحظة حرة"}
}
```

---

## 9. أدوات الرسم (Tools)
1. اختيار/سحب (Select).
2. جدار (Wall) – نقطتين.
3. ممر (Path) – متعدد النقاط.
4. مدخل/خرج (Door) – نقطة واحدة + اتجاه.
5. كشك/خدمة (Kiosk) – نقطة واحدة.
6. قطعة أرض (Plot) – مستطيل بالسحب.
7. حذف (Delete) – عند تحديد عنصر.

**Grid Snap**: دائمًا مضبوط على 10px ≡ 1 متر، يمكن تعطيله من الإعدادات السريعة.

---

## 10. متطلبات الأداء
- First Contentful Paint < 1.5s على 3G.
- Time to Interactive < 3s.
- حجم الحزمة الأولية (gzipped) < 120KB باستثناء صور SVG ثابتة.
- يعمل على متصفحات: Chrome 100+, Firefox 100+, Safari 14+, Edge 100+.
- شاشات: 320px → 4K.

---

## 11. الأمان
- لا يُسمح بـ eval أو innerHTML غير المُقيد.
- يُعقّم أي نص يُدخله المستخدم (DOMPurify) قبل عرضه.
- لا توجد معلومات حساسة تُرسل إلى الخارج.

---

## 12. خطة الترقية المستقبلية (Post-MVP)
- Back-end بسيط (Bun + Elysia) لتخزين المخططات ومشاركتها عبر رابط.
- Google Maps API: عند توفر API Key يُستبدل Canvas بالخريطة الحقيقية ويُحفظ الإحداثي الحقيقي (Lat,Lng).
- AI Module (مستقل): يستقبل بيانات الاستخدام ويقترح تحسينات على المخطط (يتم تفعيله لاحقًا عبر WebAssembly أو استدعاء خدمة خارجية).
- طباعة QR Code لكل قطعة تُعلّق على البوابة.

---

## 13. معايير القبول (Acceptance Criteria)
✅ يمكن فتح الموقع وظهور الشبكة خلال 1.5s.  
✅ كتابة «45» في البحث تعطي اقتراحًا واحدًا على الأقل.  
✅ الضغط على الاقتراح ينقل الكاميرا ويفتح منبثق.  
✅ الضغط على «تصفح المنزل» يعرض المخطط وحقول الملاحظات.  
✅ تعديل الملاحظة والضغط «حفظ» يُحدث localStorage فورًا.  
✅ أداة «قطعة أرض» ترسم مستطيلًا ملتصقًا بالشبكة.  
✅ زر «Export PNG» يُنزّل صورة واضحة 2K.  
✅ لا توجد أخطاء TypeScript.  
✅ Lighthouse Score > 90 (Performance, Accessibility).

---

## 14. المخاطر والتقليص (Risks & Mitigation)
- كبر حجم JSON: يُقسَّم لمناطق (Wilayat) ويُحمّل عند الحاجة (code-split).  
- عدم دعم Canvas على أجهزة قديمة: يوجد fallback ثابت SVG.  
- فقدان البيانات عند مسح المتصفح: يُنبّه المستخدم عند الخروج دون حفظ.

---

## 15. الجدول الزمني المقترح (1 مطوّر – 3 أسابيع)
**الأسبوع 1**  
- إعداد Bun + Vite + Tailwind.  
- رسم شبكة Grid قابلة للتكبير/التصغير.  
- أدوات Wall & Path.

**الأسبوع 2**  
- بقية الأدوات (Door, Kiosk, Plot).  
- SearchBox + JSON + منبثق.  
- HouseViewer Modal.

**الأسبوع 3**  
- localStorage Hooks.  
- Export PNG.  
- ضبط أداء + اختبار متعدد الشاشات + Lighthouse.  
- رفع DEMO على GitHub Pages.

---

## 16. ملحق – ملف package.json (Bun)
```json
{
  "name": "omana-address-map",
  "type": "module",
  "scripts": {
    "dev": "bun --hot vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "fabric": "^5.3.0",
    "html2canvas": "^1.4.1"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@vitejs/plugin-react": "^4.0.0",
    "typescript": "^5.0.0",
    "vite": "^4.4.0",
    "tailwindcss": "^3.3.0"
  }
}
```

---

انتهى PRD – جاهز للتطوير.